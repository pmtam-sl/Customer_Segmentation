<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Customer Segmentation with Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="Customer_segmentation_files/libs/clipboard/clipboard.min.js"></script>
<script src="Customer_segmentation_files/libs/quarto-html/quarto.js"></script>
<script src="Customer_segmentation_files/libs/quarto-html/popper.min.js"></script>
<script src="Customer_segmentation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Customer_segmentation_files/libs/quarto-html/anchor.min.js"></script>
<link href="Customer_segmentation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Customer_segmentation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Customer_segmentation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Customer_segmentation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Customer_segmentation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#understand-the-problem-and-business-case" id="toc-understand-the-problem-and-business-case" class="nav-link active" data-scroll-target="#understand-the-problem-and-business-case">1. Understand the problem and Business Case</a></li>
  <li><a href="#import-libraries-load-data" id="toc-import-libraries-load-data" class="nav-link" data-scroll-target="#import-libraries-load-data">2. Import libraries &amp; Load data</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">3. Exploratory Data Analysis (EDA)</a></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">4. Data Preprocessing</a></li>
  <li><a href="#feature-scalling" id="toc-feature-scalling" class="nav-link" data-scroll-target="#feature-scalling">5. Feature Scalling</a></li>
  <li><a href="#model-training" id="toc-model-training" class="nav-link" data-scroll-target="#model-training">6. Model Training</a></li>
  <li><a href="#model-evaluation-and-conclusions" id="toc-model-evaluation-and-conclusions" class="nav-link" data-scroll-target="#model-evaluation-and-conclusions">7. Model Evaluation and Conclusions</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="../Customer_segmentation.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Customer Segmentation with Python</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="understand-the-problem-and-business-case" class="level2">
<h2 class="anchored" data-anchor-id="understand-the-problem-and-business-case">1. Understand the problem and Business Case</h2>
<p>In this project, we are provided with a dataset containing customer information from a bank over the past six months. The data includes variables such as transaction frequency, transaction amounts, tenure, and other relevant features.</p>
<p>As data scientists, our task is to utilize artificial intelligence and machine learning techniques to classify customers into at least three distinct groups. The marketing team will use the results of this classification to optimize their marketing campaigns and strategies.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Cust_seg2.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></p>
</figure>
</div>
</section>
<section id="import-libraries-load-data" class="level2">
<h2 class="anchored" data-anchor-id="import-libraries-load-data">2. Import libraries &amp; Load data</h2>
<div id="108909ab" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Manipulation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Visualization</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Machine Learning</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, normalize</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_score</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Other useful libraries</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># For additional visualization (optional)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objs <span class="im">as</span> go</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># For display text as Markdown</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># from jupyterthemes import jtplot</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># jtplot.style(theme = 'monokai', context = 'notebook', ticks = True, grid=False )</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the display format for floating point numbers</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:,.3f}</span><span class="st">'</span>.<span class="bu">format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="49141b34" class="cell" data-fig-allign="left" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"../data/marketing_data.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CUST_ID</th>
<th data-quarto-table-cell-role="th">BALANCE</th>
<th data-quarto-table-cell-role="th">BALANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES</th>
<th data-quarto-table-cell-role="th">INSTALLMENTS_PURCHASES</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE</th>
<th data-quarto-table-cell-role="th">PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES_INSTALLMENTS_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_TRX</th>
<th data-quarto-table-cell-role="th">PURCHASES_TRX</th>
<th data-quarto-table-cell-role="th">CREDIT_LIMIT</th>
<th data-quarto-table-cell-role="th">PAYMENTS</th>
<th data-quarto-table-cell-role="th">MINIMUM_PAYMENTS</th>
<th data-quarto-table-cell-role="th">PRC_FULL_PAYMENT</th>
<th data-quarto-table-cell-role="th">TENURE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>C10001</td>
<td>40.901</td>
<td>0.818</td>
<td>95.400</td>
<td>0.000</td>
<td>95.400</td>
<td>0.000</td>
<td>0.167</td>
<td>0.000</td>
<td>0.083</td>
<td>0.000</td>
<td>0</td>
<td>2</td>
<td>1,000.000</td>
<td>201.802</td>
<td>139.510</td>
<td>0.000</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>C10002</td>
<td>3,202.467</td>
<td>0.909</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>6,442.945</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.250</td>
<td>4</td>
<td>0</td>
<td>7,000.000</td>
<td>4,103.033</td>
<td>1,072.340</td>
<td>0.222</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>C10003</td>
<td>2,495.149</td>
<td>1.000</td>
<td>773.170</td>
<td>773.170</td>
<td>0.000</td>
<td>0.000</td>
<td>1.000</td>
<td>1.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0</td>
<td>12</td>
<td>7,500.000</td>
<td>622.067</td>
<td>627.285</td>
<td>0.000</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>C10004</td>
<td>1,666.671</td>
<td>0.636</td>
<td>1,499.000</td>
<td>1,499.000</td>
<td>0.000</td>
<td>205.788</td>
<td>0.083</td>
<td>0.083</td>
<td>0.000</td>
<td>0.083</td>
<td>1</td>
<td>1</td>
<td>7,500.000</td>
<td>0.000</td>
<td>NaN</td>
<td>0.000</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>C10005</td>
<td>817.714</td>
<td>1.000</td>
<td>16.000</td>
<td>16.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.083</td>
<td>0.083</td>
<td>0.000</td>
<td>0.000</td>
<td>0</td>
<td>1</td>
<td>1,200.000</td>
<td>678.335</td>
<td>244.791</td>
<td>0.000</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8945</td>
<td>C19186</td>
<td>28.494</td>
<td>1.000</td>
<td>291.120</td>
<td>0.000</td>
<td>291.120</td>
<td>0.000</td>
<td>1.000</td>
<td>0.000</td>
<td>0.833</td>
<td>0.000</td>
<td>0</td>
<td>6</td>
<td>1,000.000</td>
<td>325.594</td>
<td>48.886</td>
<td>0.500</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8946</td>
<td>C19187</td>
<td>19.183</td>
<td>1.000</td>
<td>300.000</td>
<td>0.000</td>
<td>300.000</td>
<td>0.000</td>
<td>1.000</td>
<td>0.000</td>
<td>0.833</td>
<td>0.000</td>
<td>0</td>
<td>6</td>
<td>1,000.000</td>
<td>275.861</td>
<td>NaN</td>
<td>0.000</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8947</td>
<td>C19188</td>
<td>23.399</td>
<td>0.833</td>
<td>144.400</td>
<td>0.000</td>
<td>144.400</td>
<td>0.000</td>
<td>0.833</td>
<td>0.000</td>
<td>0.667</td>
<td>0.000</td>
<td>0</td>
<td>5</td>
<td>1,000.000</td>
<td>81.271</td>
<td>82.418</td>
<td>0.250</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8948</td>
<td>C19189</td>
<td>13.458</td>
<td>0.833</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>36.559</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.167</td>
<td>2</td>
<td>0</td>
<td>500.000</td>
<td>52.550</td>
<td>55.756</td>
<td>0.250</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8949</td>
<td>C19190</td>
<td>372.708</td>
<td>0.667</td>
<td>1,093.250</td>
<td>1,093.250</td>
<td>0.000</td>
<td>127.040</td>
<td>0.667</td>
<td>0.667</td>
<td>0.000</td>
<td>0.333</td>
<td>2</td>
<td>23</td>
<td>1,200.000</td>
<td>63.165</td>
<td>88.289</td>
<td>0.000</td>
<td>6</td>
</tr>
</tbody>
</table>

<p>8950 rows × 18 columns</p>
</div>
</div>
</div>
<div id="24ffbe44" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 8950 entries, 0 to 8949
Data columns (total 18 columns):
 #   Column                            Non-Null Count  Dtype  
---  ------                            --------------  -----  
 0   CUST_ID                           8950 non-null   object 
 1   BALANCE                           8950 non-null   float64
 2   BALANCE_FREQUENCY                 8950 non-null   float64
 3   PURCHASES                         8950 non-null   float64
 4   ONEOFF_PURCHASES                  8950 non-null   float64
 5   INSTALLMENTS_PURCHASES            8950 non-null   float64
 6   CASH_ADVANCE                      8950 non-null   float64
 7   PURCHASES_FREQUENCY               8950 non-null   float64
 8   ONEOFF_PURCHASES_FREQUENCY        8950 non-null   float64
 9   PURCHASES_INSTALLMENTS_FREQUENCY  8950 non-null   float64
 10  CASH_ADVANCE_FREQUENCY            8950 non-null   float64
 11  CASH_ADVANCE_TRX                  8950 non-null   int64  
 12  PURCHASES_TRX                     8950 non-null   int64  
 13  CREDIT_LIMIT                      8949 non-null   float64
 14  PAYMENTS                          8950 non-null   float64
 15  MINIMUM_PAYMENTS                  8637 non-null   float64
 16  PRC_FULL_PAYMENT                  8950 non-null   float64
 17  TENURE                            8950 non-null   int64  
dtypes: float64(14), int64(3), object(1)
memory usage: 1.2+ MB</code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>Field Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CUSTID</td>
<td>Identification of Credit Card holder</td>
</tr>
<tr class="even">
<td>BALANCE</td>
<td>Balance amount left in customer’s account to make purchases</td>
</tr>
<tr class="odd">
<td>BALANCE_FREQUENCY</td>
<td>How frequently the Balance is updated, score between 0 and 1 (1 = frequently updated, 0 = not frequently updated)</td>
</tr>
<tr class="even">
<td>PURCHASES</td>
<td>Amount of purchases made from account</td>
</tr>
<tr class="odd">
<td>ONEOFFPURCHASES</td>
<td>Maximum purchase amount done in one-go</td>
</tr>
<tr class="even">
<td>INSTALLMENTS_PURCHASES</td>
<td>Amount of purchase done in installment</td>
</tr>
<tr class="odd">
<td>CASH_ADVANCE</td>
<td>Cash in advance given by the user</td>
</tr>
<tr class="even">
<td>PURCHASES_FREQUENCY</td>
<td>How frequently the Purchases are being made, score between 0 and 1 (1 = frequently purchased, 0 = not frequently purchased)</td>
</tr>
<tr class="odd">
<td>ONEOFF_PURCHASES_FREQUENCY</td>
<td>How frequently Purchases are happening in one-go (1 = frequently purchased, 0 = not frequently purchased)</td>
</tr>
<tr class="even">
<td>PURCHASES_INSTALLMENTS_FREQUENCY</td>
<td>How frequently purchases in installments are being done (1 = frequently done, 0 = not frequently done)</td>
</tr>
<tr class="odd">
<td>CASH_ADVANCE_FREQUENCY</td>
<td>How frequently the cash in advance being paid</td>
</tr>
<tr class="even">
<td>CASH_ADVANCE_TRX</td>
<td>Number of Transactions made with “Cash in Advance”</td>
</tr>
<tr class="odd">
<td>PURCHASES_TRX</td>
<td>Number of purchase transactions made</td>
</tr>
<tr class="even">
<td>CREDIT_LIMIT</td>
<td>Limit of Credit Card for user</td>
</tr>
<tr class="odd">
<td>PAYMENTS</td>
<td>Amount of Payment done by user</td>
</tr>
<tr class="even">
<td>MINIMUM_PAYMENTS</td>
<td>Minimum amount of payments made by user</td>
</tr>
<tr class="odd">
<td>PRC_FULL_PAYMENT</td>
<td>Percent of full payment paid by user</td>
</tr>
<tr class="even">
<td>TENURE</td>
<td>Tenure of credit card service for user</td>
</tr>
</tbody>
</table>
</section>
<section id="exploratory-data-analysis-eda" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">3. Exploratory Data Analysis (EDA)</h2>
<p>Let’s check the basic statistics and visualize some features:</p>
<section id="descriptive-statistics" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics">Descriptive statistics</h3>
<div id="b6b30847" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic statistics</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BALANCE</th>
<th data-quarto-table-cell-role="th">BALANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES</th>
<th data-quarto-table-cell-role="th">INSTALLMENTS_PURCHASES</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE</th>
<th data-quarto-table-cell-role="th">PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES_INSTALLMENTS_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_TRX</th>
<th data-quarto-table-cell-role="th">PURCHASES_TRX</th>
<th data-quarto-table-cell-role="th">CREDIT_LIMIT</th>
<th data-quarto-table-cell-role="th">PAYMENTS</th>
<th data-quarto-table-cell-role="th">MINIMUM_PAYMENTS</th>
<th data-quarto-table-cell-role="th">PRC_FULL_PAYMENT</th>
<th data-quarto-table-cell-role="th">TENURE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
<td>8,949.000</td>
<td>8,950.000</td>
<td>8,637.000</td>
<td>8,950.000</td>
<td>8,950.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>1,564.475</td>
<td>0.877</td>
<td>1,003.205</td>
<td>592.437</td>
<td>411.068</td>
<td>978.871</td>
<td>0.490</td>
<td>0.202</td>
<td>0.364</td>
<td>0.135</td>
<td>3.249</td>
<td>14.710</td>
<td>4,494.449</td>
<td>1,733.144</td>
<td>864.207</td>
<td>0.154</td>
<td>11.517</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2,081.532</td>
<td>0.237</td>
<td>2,136.635</td>
<td>1,659.888</td>
<td>904.338</td>
<td>2,097.164</td>
<td>0.401</td>
<td>0.298</td>
<td>0.397</td>
<td>0.200</td>
<td>6.825</td>
<td>24.858</td>
<td>3,638.816</td>
<td>2,895.064</td>
<td>2,372.447</td>
<td>0.292</td>
<td>1.338</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>50.000</td>
<td>0.000</td>
<td>0.019</td>
<td>0.000</td>
<td>6.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>128.282</td>
<td>0.889</td>
<td>39.635</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.083</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>1.000</td>
<td>1,600.000</td>
<td>383.276</td>
<td>169.124</td>
<td>0.000</td>
<td>12.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>873.385</td>
<td>1.000</td>
<td>361.280</td>
<td>38.000</td>
<td>89.000</td>
<td>0.000</td>
<td>0.500</td>
<td>0.083</td>
<td>0.167</td>
<td>0.000</td>
<td>0.000</td>
<td>7.000</td>
<td>3,000.000</td>
<td>856.902</td>
<td>312.344</td>
<td>0.000</td>
<td>12.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>2,054.140</td>
<td>1.000</td>
<td>1,110.130</td>
<td>577.405</td>
<td>468.637</td>
<td>1,113.821</td>
<td>0.917</td>
<td>0.300</td>
<td>0.750</td>
<td>0.222</td>
<td>4.000</td>
<td>17.000</td>
<td>6,500.000</td>
<td>1,901.134</td>
<td>825.485</td>
<td>0.143</td>
<td>12.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>19,043.139</td>
<td>1.000</td>
<td>49,039.570</td>
<td>40,761.250</td>
<td>22,500.000</td>
<td>47,137.212</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.500</td>
<td>123.000</td>
<td>358.000</td>
<td>30,000.000</td>
<td>50,721.483</td>
<td>76,406.208</td>
<td>1.000</td>
<td>12.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Key Insights from Descriptive Statistics:</strong></p>
<ul>
<li>The mean balance of customers is approximately $1,564.</li>
<li>The balance frequency is updated frequently, with an average of around 0.9.</li>
<li>The average purchase amount is about $1,000.</li>
<li>The mean one-off purchase amount is roughly $600.</li>
<li>The average purchases frequency is around 0.5.</li>
<li>The average frequencies for one-off purchases, installment purchases, and cash advances are generally low.</li>
<li>The average credit limit for customers is around $4,500.</li>
<li>The percentage of full payments made is 15%.</li>
<li>The average tenure of customers is 11 years.</li>
</ul>
<div id="9532170f" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see if we have any missing data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(data.isnull(), yticklabels<span class="op">=</span><span class="va">False</span>, cbar<span class="op">=</span><span class="va">False</span>, cmap<span class="op">=</span><span class="st">"Blues"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Customer_segmentation_files/figure-html/cell-6-output-1.png" width="540" height="673" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="ed11737a" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>CUST_ID                               0
BALANCE                               0
BALANCE_FREQUENCY                     0
PURCHASES                             0
ONEOFF_PURCHASES                      0
INSTALLMENTS_PURCHASES                0
CASH_ADVANCE                          0
PURCHASES_FREQUENCY                   0
ONEOFF_PURCHASES_FREQUENCY            0
PURCHASES_INSTALLMENTS_FREQUENCY      0
CASH_ADVANCE_FREQUENCY                0
CASH_ADVANCE_TRX                      0
PURCHASES_TRX                         0
CREDIT_LIMIT                          1
PAYMENTS                              0
MINIMUM_PAYMENTS                    313
PRC_FULL_PAYMENT                      0
TENURE                                0
dtype: int64</code></pre>
</div>
</div>
<p>There are missing data in <code>MINIMUM_PAYMENTS</code> and <code>CREDIT_LIMIT</code>.</p>
</section>
<section id="distributions-of-numerical-features" class="level3">
<h3 class="anchored" data-anchor-id="distributions-of-numerical-features">Distributions of numerical features</h3>
<div id="8789dd2b" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize distributions of numerical features</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>data.hist(bins<span class="op">=</span><span class="dv">20</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Customer_segmentation_files/figure-html/cell-8-output-1.png" width="1427" height="949" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-matrix-between-features" class="level3">
<h3 class="anchored" data-anchor-id="correlation-matrix-between-features">Correlation matrix between features</h3>
<div id="bfc1c344" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>data_numeric <span class="op">=</span> data.drop(columns<span class="op">=</span>[<span class="st">"CUST_ID"</span>])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(data_numeric.corr(), annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">".2f"</span>, cmap<span class="op">=</span><span class="st">"coolwarm"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Customer_segmentation_files/figure-html/cell-9-output-1.png" width="1134" height="900" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The heatmap provides a visual representation of the correlation coefficients, with colors indicating the strength and direction of the correlations</p>
<p><strong><em>Strong Positive Correlations:</em></strong></p>
<ul>
<li><p><code>PURCHASES</code> and <code>ONEOFF_PURCHASES</code> (0.92): Indicates that one-off purchases are a major component of total purchases.</p></li>
<li><p><code>PURCHASES_INSTALLMENTS_FREQUENCY</code> and <code>PURCHASES_FREQUENCY</code> (0.86): Indicates that the frequency of installment purchases is closely related to the overall frequency of purchases.</p></li>
<li><p><code>CASH_ADVANCE</code> and <code>CASH_ADVANCE_TRX</code> (0.66): Indicates that the amount of cash advances is strongly related to the number of cash advance transactions.</p></li>
</ul>
<p><strong><em>Moderate Positive Correlations:</em></strong></p>
<ul>
<li><code>CREDIT_LIMIT</code> and <code>BALANCE</code> (0.53): Suggests that higher credit limits are associated with higher balances.</li>
<li><code>PURCHASES</code> and <code>PURCHASES_TRX</code> (0.69): Indicates a moderate relationship between total purchases and the number of purchase transactions.</li>
<li><code>PAYMENTS</code> and <code>PURCHASES</code> (0.60): Indicates that higher payments are associated with higher purchase amounts</li>
</ul>
<p><strong><em>Strong Negative Correlations:</em></strong></p>
<ul>
<li><code>PRC_FULL_PAYMENT</code> and <code>BALANCE</code> (-0.32): Indicates that a higher percentage of full payments is associated with lower balances.</li>
</ul>
<p><strong><em>Moderate Negative Correlations:</em></strong></p>
<ul>
<li><code>CASH_ADVANCE_FREQUENCY</code> and <code>PURCHASES_INSTALLMENTS_FREQUENCY</code> (-0.31): Suggests that frequent cash advances are associated with less frequent installment purchases.</li>
</ul>
</section>
<section id="analytical-points-from-eda" class="level3">
<h3 class="anchored" data-anchor-id="analytical-points-from-eda">Analytical Points from EDA:</h3>
<p><strong>1. Customer Engagement:</strong> The high mean balance ($1,564) and frequent balance (average balance frequency of ~0.9) indicate active account management and regular transactions by customers.</p>
<p><strong>2. Spending Behavior:</strong> With an average purchase amount of $1,000 and an average one-off purchase amount of ~$600, customers seem to engage in both frequent smaller purchases and occasional larger one-off purchases.</p>
<p><strong>3. Low Frequency Transactions:</strong> The generally low average frequencies for one-off purchases, installment purchases, and cash advances suggest that while customers do make these types of transactions, they do so infrequently.</p>
<p><strong>4. Credit Utilization:</strong> The average credit limit of $4,500 suggests that the bank extends a significant amount of credit to its customers. However, the actual usage and payment patterns (such as the 15% full payment rate) indicate varying levels of credit utilization and repayment behavior.</p>
<p><strong>5. Financial Responsibility:</strong> The relatively low percentage of full payments (15%) might indicate that a large proportion of customers are not paying off their balances in full each month, which could lead to higher interest income for the bank but also suggests potential financial strain on customers.</p>
<p><strong>6. Customer Loyalty:</strong> An average tenure of 11 years highlights a strong customer loyalty and long-term relationship with the bank, which is a positive indicator of customer satisfaction and retention.</p>
<p><strong>7. Marketing Strategy Implications:</strong> These insights can help the marketing team tailor their campaigns to different customer segments. For example, they could target customers with high balances and low payment rates with offers for balance transfer or debt consolidation products, or incentivize frequent small purchasers with rewards programs.</p>
</section>
</section>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">4. Data Preprocessing</h2>
<p>Handle missing values and prepare the data for clustering:</p>
<div id="d32404ea" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop non-numeric columns if necessary (e.g., CUST_ID)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.drop(columns<span class="op">=</span>[<span class="st">"CUST_ID"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4f209c33" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing values with mean</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.fillna(data.mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1d0de533" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if any missing value again</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>BALANCE                             0
BALANCE_FREQUENCY                   0
PURCHASES                           0
ONEOFF_PURCHASES                    0
INSTALLMENTS_PURCHASES              0
CASH_ADVANCE                        0
PURCHASES_FREQUENCY                 0
ONEOFF_PURCHASES_FREQUENCY          0
PURCHASES_INSTALLMENTS_FREQUENCY    0
CASH_ADVANCE_FREQUENCY              0
CASH_ADVANCE_TRX                    0
PURCHASES_TRX                       0
CREDIT_LIMIT                        0
PAYMENTS                            0
MINIMUM_PAYMENTS                    0
PRC_FULL_PAYMENT                    0
TENURE                              0
dtype: int64</code></pre>
</div>
</div>
<div id="d9f31ece" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see if we have duplicated entries in the data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>data.duplicated().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0</code></pre>
</div>
</div>
</section>
<section id="feature-scalling" class="level2">
<h2 class="anchored" data-anchor-id="feature-scalling">5. Feature Scalling</h2>
<p>Standardize the features before clustering:</p>
<div id="bf9429f8" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize the data</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="op">=</span> scaler.fit_transform(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6a904afa" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>scaled_data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(8950, 17)</code></pre>
</div>
</div>
<div id="55cafb98" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>scaled_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array([[-0.73198937, -0.24943448, -0.42489974, ..., -0.31096755,
        -0.52555097,  0.36067954],
       [ 0.78696085,  0.13432467, -0.46955188, ...,  0.08931021,
         0.2342269 ,  0.36067954],
       [ 0.44713513,  0.51808382, -0.10766823, ..., -0.10166318,
        -0.52555097,  0.36067954],
       ...,
       [-0.7403981 , -0.18547673, -0.40196519, ..., -0.33546549,
         0.32919999, -4.12276757],
       [-0.74517423, -0.18547673, -0.46955188, ..., -0.34690648,
         0.32919999, -4.12276757],
       [-0.57257511, -0.88903307,  0.04214581, ..., -0.33294642,
        -0.52555097, -4.12276757]])</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why do we need scaling data before clustering ?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Scaling data before clustering is important because many clustering algorithms rely on distance measures, such as Euclidean distance, to determine the similarity between data points. If the data is not scaled, features with larger ranges can dominate the distance calculations, potentially skewing the results.</p>
<p>Common methods for scaling data include:</p>
<ul>
<li><p><strong>Standardization</strong>: Transforming the data to have a mean of zero and a standard deviation of one.</p></li>
<li><p><strong>Normalization</strong>: Scaling the data to a specific range, usually [0, 1] or [-1, 1].</p></li>
</ul>
<p>By scaling the data, we ensure that the clustering results are more reliable and meaningful.</p>
</div>
</div>
</section>
<section id="model-training" class="level2">
<h2 class="anchored" data-anchor-id="model-training">6. Model Training</h2>
<section id="apply-k-means-clustering" class="level3">
<h3 class="anchored" data-anchor-id="apply-k-means-clustering">Apply K-Means clustering</h3>
<p>Apply K-Means clustering and determine the optimal number of clusters</p>
<div id="6142c3a2" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the optimal number of clusters using the elbow method</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>wcss <span class="op">=</span> []</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">20</span>):</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        n_clusters<span class="op">=</span>i, init<span class="op">=</span><span class="st">"k-means++"</span>, max_iter<span class="op">=</span><span class="dv">300</span>, n_init<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    kmeans.fit(scaled_data)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    wcss.append(kmeans.inertia_)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the elbow method graph</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>plt.plot(wcss, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Elbow Method"</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Number of clusters"</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"WCSS"</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Customer_segmentation_files/figure-html/cell-17-output-1.png" width="842" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Choose the optimal number of clusters (e.g., 7 based on the elbow method) and fit the K-Means model:</p>
<div id="f2365cfe" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit K-Means model</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>optimal_clusters <span class="op">=</span> <span class="dv">7</span>  <span class="co"># Based on the elbow method</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    n_clusters<span class="op">=</span>optimal_clusters,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    init<span class="op">=</span><span class="st">"k-means++"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    n_init<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>kmeans.fit(scaled_data)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>kmeans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KMeans(n_clusters=7, n_init=10, random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;KMeans<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.cluster.KMeans.html">?<span>Documentation for KMeans</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>KMeans(n_clusters=7, n_init=10, random_state=42)</pre></div> </div></div></div></div>
</div>
</div>
<div id="5fba4582" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster_center shape</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>kmeans.cluster_centers_.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>(7, 17)</code></pre>
</div>
</div>
<div id="9fd24f30" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster_center scaled values</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>cluster_centers <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>kmeans.cluster_centers_, columns<span class="op">=</span>[data.columns])</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>cluster_centers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BALANCE</th>
<th data-quarto-table-cell-role="th">BALANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES</th>
<th data-quarto-table-cell-role="th">INSTALLMENTS_PURCHASES</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE</th>
<th data-quarto-table-cell-role="th">PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES_INSTALLMENTS_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_TRX</th>
<th data-quarto-table-cell-role="th">PURCHASES_TRX</th>
<th data-quarto-table-cell-role="th">CREDIT_LIMIT</th>
<th data-quarto-table-cell-role="th">PAYMENTS</th>
<th data-quarto-table-cell-role="th">MINIMUM_PAYMENTS</th>
<th data-quarto-table-cell-role="th">PRC_FULL_PAYMENT</th>
<th data-quarto-table-cell-role="th">TENURE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.430</td>
<td>0.419</td>
<td>6.915</td>
<td>6.083</td>
<td>5.172</td>
<td>0.039</td>
<td>1.091</td>
<td>1.879</td>
<td>1.049</td>
<td>-0.249</td>
<td>-0.038</td>
<td>4.646</td>
<td>2.198</td>
<td>4.784</td>
<td>1.081</td>
<td>0.824</td>
<td>0.335</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.666</td>
<td>0.392</td>
<td>-0.205</td>
<td>-0.150</td>
<td>-0.210</td>
<td>1.991</td>
<td>-0.457</td>
<td>-0.190</td>
<td>-0.404</td>
<td>1.909</td>
<td>1.922</td>
<td>-0.241</td>
<td>1.008</td>
<td>0.835</td>
<td>0.553</td>
<td>-0.391</td>
<td>0.070</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.127</td>
<td>0.430</td>
<td>0.939</td>
<td>0.896</td>
<td>0.574</td>
<td>-0.309</td>
<td>1.093</td>
<td>1.873</td>
<td>0.535</td>
<td>-0.410</td>
<td>-0.321</td>
<td>1.197</td>
<td>0.702</td>
<td>0.385</td>
<td>-0.057</td>
<td>0.456</td>
<td>0.308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-0.368</td>
<td>0.331</td>
<td>-0.040</td>
<td>-0.235</td>
<td>0.337</td>
<td>-0.368</td>
<td>0.981</td>
<td>-0.357</td>
<td>1.173</td>
<td>-0.478</td>
<td>-0.362</td>
<td>0.174</td>
<td>-0.278</td>
<td>-0.222</td>
<td>-0.016</td>
<td>0.307</td>
<td>0.252</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.336</td>
<td>-0.348</td>
<td>-0.285</td>
<td>-0.209</td>
<td>-0.288</td>
<td>0.066</td>
<td>-0.199</td>
<td>-0.273</td>
<td>-0.231</td>
<td>0.304</td>
<td>-0.002</td>
<td>-0.386</td>
<td>-0.557</td>
<td>-0.391</td>
<td>-0.209</td>
<td>0.013</td>
<td>-3.194</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.008</td>
<td>0.403</td>
<td>-0.344</td>
<td>-0.225</td>
<td>-0.399</td>
<td>-0.104</td>
<td>-0.810</td>
<td>-0.336</td>
<td>-0.752</td>
<td>0.085</td>
<td>-0.042</td>
<td>-0.465</td>
<td>-0.301</td>
<td>-0.249</td>
<td>-0.016</td>
<td>-0.453</td>
<td>0.272</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>-0.702</td>
<td>-2.134</td>
<td>-0.307</td>
<td>-0.230</td>
<td>-0.303</td>
<td>-0.323</td>
<td>-0.547</td>
<td>-0.428</td>
<td>-0.441</td>
<td>-0.522</td>
<td>-0.377</td>
<td>-0.417</td>
<td>-0.173</td>
<td>-0.202</td>
<td>-0.258</td>
<td>0.295</td>
<td>0.201</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Cluster Centers</strong></p>
<div id="bc892d35" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In order to understand what these numbers mean, let's perform inverse transformation</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>cluster_centers <span class="op">=</span> scaler.inverse_transform(cluster_centers)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>cluster_centers <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>cluster_centers, columns<span class="op">=</span>[data.columns])</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>cluster_centers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BALANCE</th>
<th data-quarto-table-cell-role="th">BALANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES</th>
<th data-quarto-table-cell-role="th">INSTALLMENTS_PURCHASES</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE</th>
<th data-quarto-table-cell-role="th">PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES_INSTALLMENTS_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_TRX</th>
<th data-quarto-table-cell-role="th">PURCHASES_TRX</th>
<th data-quarto-table-cell-role="th">CREDIT_LIMIT</th>
<th data-quarto-table-cell-role="th">PAYMENTS</th>
<th data-quarto-table-cell-role="th">MINIMUM_PAYMENTS</th>
<th data-quarto-table-cell-role="th">PRC_FULL_PAYMENT</th>
<th data-quarto-table-cell-role="th">TENURE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4,541.394</td>
<td>0.977</td>
<td>15,777.311</td>
<td>10,689.028</td>
<td>5,088.284</td>
<td>1,060.191</td>
<td>0.928</td>
<td>0.763</td>
<td>0.782</td>
<td>0.085</td>
<td>2.988</td>
<td>130.198</td>
<td>12,493.023</td>
<td>15,581.497</td>
<td>3,383.304</td>
<td>0.395</td>
<td>11.965</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5,033.097</td>
<td>0.970</td>
<td>564.520</td>
<td>343.613</td>
<td>221.021</td>
<td>5,153.574</td>
<td>0.307</td>
<td>0.146</td>
<td>0.204</td>
<td>0.517</td>
<td>16.366</td>
<td>8.709</td>
<td>8,160.464</td>
<td>4,149.870</td>
<td>2,152.886</td>
<td>0.039</td>
<td>11.611</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1,828.400</td>
<td>0.979</td>
<td>3,009.455</td>
<td>2,079.428</td>
<td>930.501</td>
<td>330.621</td>
<td>0.929</td>
<td>0.761</td>
<td>0.577</td>
<td>0.053</td>
<td>1.060</td>
<td>44.459</td>
<td>7,047.419</td>
<td>2,847.821</td>
<td>730.294</td>
<td>0.287</td>
<td>11.929</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>799.440</td>
<td>0.956</td>
<td>918.086</td>
<td>202.469</td>
<td>716.053</td>
<td>206.951</td>
<td>0.884</td>
<td>0.096</td>
<td>0.831</td>
<td>0.040</td>
<td>0.776</td>
<td>19.032</td>
<td>3,482.113</td>
<td>1,091.027</td>
<td>827.538</td>
<td>0.244</td>
<td>11.855</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>866.148</td>
<td>0.795</td>
<td>395.312</td>
<td>245.586</td>
<td>150.203</td>
<td>1,116.309</td>
<td>0.411</td>
<td>0.121</td>
<td>0.273</td>
<td>0.196</td>
<td>3.234</td>
<td>5.126</td>
<td>2,468.226</td>
<td>602.104</td>
<td>376.248</td>
<td>0.157</td>
<td>7.243</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1,580.736</td>
<td>0.973</td>
<td>268.426</td>
<td>218.629</td>
<td>49.971</td>
<td>760.334</td>
<td>0.165</td>
<td>0.102</td>
<td>0.065</td>
<td>0.152</td>
<td>2.964</td>
<td>3.161</td>
<td>3,399.161</td>
<td>1,012.581</td>
<td>827.407</td>
<td>0.021</td>
<td>11.882</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>103.587</td>
<td>0.372</td>
<td>347.456</td>
<td>210.200</td>
<td>137.507</td>
<td>301.361</td>
<td>0.271</td>
<td>0.075</td>
<td>0.189</td>
<td>0.031</td>
<td>0.677</td>
<td>4.356</td>
<td>3,865.956</td>
<td>1,149.109</td>
<td>263.989</td>
<td>0.240</td>
<td>11.786</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Classify data into clusters</strong></p>
<div id="1b3d9cd1" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>markdown_text <span class="op">=</span> <span class="ss">f"Our account data is now classified into `</span><span class="sc">{</span>optimal_clusters<span class="sc">}</span><span class="ss">` clusters"</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>Markdown(markdown_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="21">
<p>Our account data is now classified into <code>7</code> clusters</p>
</div>
</div>
<div id="0084ea3f" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict cluster from scaled_data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="op">=</span> kmeans.fit_predict(scaled_data)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the cluster labels to the original data</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"Cluster"</span>] <span class="op">=</span> clusters</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BALANCE</th>
<th data-quarto-table-cell-role="th">BALANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES</th>
<th data-quarto-table-cell-role="th">INSTALLMENTS_PURCHASES</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE</th>
<th data-quarto-table-cell-role="th">PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">ONEOFF_PURCHASES_FREQUENCY</th>
<th data-quarto-table-cell-role="th">PURCHASES_INSTALLMENTS_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_FREQUENCY</th>
<th data-quarto-table-cell-role="th">CASH_ADVANCE_TRX</th>
<th data-quarto-table-cell-role="th">PURCHASES_TRX</th>
<th data-quarto-table-cell-role="th">CREDIT_LIMIT</th>
<th data-quarto-table-cell-role="th">PAYMENTS</th>
<th data-quarto-table-cell-role="th">MINIMUM_PAYMENTS</th>
<th data-quarto-table-cell-role="th">PRC_FULL_PAYMENT</th>
<th data-quarto-table-cell-role="th">TENURE</th>
<th data-quarto-table-cell-role="th">Cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>40.901</td>
<td>0.818</td>
<td>95.400</td>
<td>0.000</td>
<td>95.400</td>
<td>0.000</td>
<td>0.167</td>
<td>0.000</td>
<td>0.083</td>
<td>0.000</td>
<td>0</td>
<td>2</td>
<td>1,000.000</td>
<td>201.802</td>
<td>139.510</td>
<td>0.000</td>
<td>12</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3,202.467</td>
<td>0.909</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>6,442.945</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.250</td>
<td>4</td>
<td>0</td>
<td>7,000.000</td>
<td>4,103.033</td>
<td>1,072.340</td>
<td>0.222</td>
<td>12</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2,495.149</td>
<td>1.000</td>
<td>773.170</td>
<td>773.170</td>
<td>0.000</td>
<td>0.000</td>
<td>1.000</td>
<td>1.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0</td>
<td>12</td>
<td>7,500.000</td>
<td>622.067</td>
<td>627.285</td>
<td>0.000</td>
<td>12</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1,666.671</td>
<td>0.636</td>
<td>1,499.000</td>
<td>1,499.000</td>
<td>0.000</td>
<td>205.788</td>
<td>0.083</td>
<td>0.083</td>
<td>0.000</td>
<td>0.083</td>
<td>1</td>
<td>1</td>
<td>7,500.000</td>
<td>0.000</td>
<td>864.207</td>
<td>0.000</td>
<td>12</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>817.714</td>
<td>1.000</td>
<td>16.000</td>
<td>16.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.083</td>
<td>0.083</td>
<td>0.000</td>
<td>0.000</td>
<td>0</td>
<td>1</td>
<td>1,200.000</td>
<td>678.335</td>
<td>244.791</td>
<td>0.000</td>
<td>12</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8945</td>
<td>28.494</td>
<td>1.000</td>
<td>291.120</td>
<td>0.000</td>
<td>291.120</td>
<td>0.000</td>
<td>1.000</td>
<td>0.000</td>
<td>0.833</td>
<td>0.000</td>
<td>0</td>
<td>6</td>
<td>1,000.000</td>
<td>325.594</td>
<td>48.886</td>
<td>0.500</td>
<td>6</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8946</td>
<td>19.183</td>
<td>1.000</td>
<td>300.000</td>
<td>0.000</td>
<td>300.000</td>
<td>0.000</td>
<td>1.000</td>
<td>0.000</td>
<td>0.833</td>
<td>0.000</td>
<td>0</td>
<td>6</td>
<td>1,000.000</td>
<td>275.861</td>
<td>864.207</td>
<td>0.000</td>
<td>6</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8947</td>
<td>23.399</td>
<td>0.833</td>
<td>144.400</td>
<td>0.000</td>
<td>144.400</td>
<td>0.000</td>
<td>0.833</td>
<td>0.000</td>
<td>0.667</td>
<td>0.000</td>
<td>0</td>
<td>5</td>
<td>1,000.000</td>
<td>81.271</td>
<td>82.418</td>
<td>0.250</td>
<td>6</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8948</td>
<td>13.458</td>
<td>0.833</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>36.559</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.167</td>
<td>2</td>
<td>0</td>
<td>500.000</td>
<td>52.550</td>
<td>55.756</td>
<td>0.250</td>
<td>6</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8949</td>
<td>372.708</td>
<td>0.667</td>
<td>1,093.250</td>
<td>1,093.250</td>
<td>0.000</td>
<td>127.040</td>
<td>0.667</td>
<td>0.667</td>
<td>0.000</td>
<td>0.333</td>
<td>2</td>
<td>23</td>
<td>1,200.000</td>
<td>63.165</td>
<td>88.289</td>
<td>0.000</td>
<td>6</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>8950 rows × 18 columns</p>
</div>
</div>
</div>
<p>Let’s view account distribution by <code>7</code> clusters</p>
<div id="50c14930" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Total account by cluster</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="op">=</span> data[<span class="st">"Cluster"</span>].value_counts()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cluster_counts)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the pie chart</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>plt.pie(cluster_counts, labels<span class="op">=</span>cluster_counts.index, autopct<span class="op">=</span><span class="st">"</span><span class="sc">%1.1f%%</span><span class="st">"</span>, startangle<span class="op">=</span><span class="dv">140</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Account Distribution by Cluster"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster
5    2841
3    2046
2    1267
6    1187
1     894
4     629
0      86
Name: count, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Customer_segmentation_files/figure-html/cell-24-output-2.png" width="389" height="409" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="apply-principal-component-analysis-pca" class="level3">
<h3 class="anchored" data-anchor-id="apply-principal-component-analysis-pca">Apply Principal Component Analysis (PCA)</h3>
<div id="e26341c8" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply PCA</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>principal_components <span class="op">=</span> pca.fit_transform(scaled_data)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>pc_df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>principal_components, columns<span class="op">=</span>[<span class="st">"PC1"</span>, <span class="st">"PC2"</span>])</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>pc_df[<span class="st">"Cluster"</span>] <span class="op">=</span> clusters</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrames for the different cluster groups</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>pc_df_all <span class="op">=</span> pc_df.copy()</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>pc_df_2356 <span class="op">=</span> pc_df[pc_df[<span class="st">"Cluster"</span>].isin([<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>])].copy()</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>pc_df_014 <span class="op">=</span> pc_df[pc_df[<span class="st">"Cluster"</span>].isin([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">4</span>])].copy()</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure with GridSpec</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> fig.add_gridspec(<span class="dv">2</span>, <span class="dv">2</span>, height_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for all clusters in the first row spanning both columns</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, :])</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"PC1"</span>, y<span class="op">=</span><span class="st">"PC2"</span>, hue<span class="op">=</span><span class="st">"Cluster"</span>, data<span class="op">=</span>pc_df_all,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>[<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"pink"</span>, <span class="st">"yellow"</span>, <span class="st">"gray"</span>, <span class="st">"purple"</span>, <span class="st">"black"</span>],</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">70</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, ax<span class="op">=</span>ax1</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"All Clusters Visualization using PCA"</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">##ax1.legend(loc='center left', bbox_to_anchor=(1, 0.5))</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine limits for x and y axes from the first plot</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>x_limits <span class="op">=</span> ax1.get_xlim()</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>y_limits <span class="op">=</span> ax1.get_ylim()</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for clusters 2, 3, 5, and 6 in the second row, first column</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"PC1"</span>, y<span class="op">=</span><span class="st">"PC2"</span>, hue<span class="op">=</span><span class="st">"Cluster"</span>, data<span class="op">=</span>pc_df_2356,</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>[<span class="st">"blue"</span>,<span class="st">"pink"</span>, <span class="st">"gray"</span>, <span class="st">"purple"</span>],</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">70</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, ax<span class="op">=</span>ax2</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"Clusters 2, 3, 5, 6"</span>)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>ax2.set_xlim(x_limits)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim(y_limits)</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="co">##ax2.legend(loc='center left', bbox_to_anchor=(1, 0.5))</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for clusters 0, 1, and 4 in the second row, second column</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"PC1"</span>, y<span class="op">=</span><span class="st">"PC2"</span>, hue<span class="op">=</span><span class="st">"Cluster"</span>, data<span class="op">=</span>pc_df_014,</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>[<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span>],</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">70</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, ax<span class="op">=</span>ax3</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">"Clusters 0, 1, 4"</span>)</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>ax3.set_xlim(x_limits)</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>ax3.set_ylim(y_limits)</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a><span class="co">#ax3.legend(loc='center left', bbox_to_anchor=(1, 0.5))</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout to prevent overlap</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Customer_segmentation_files/figure-html/cell-25-output-1.png" width="1141" height="1140" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-evaluation-and-conclusions" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation-and-conclusions">7. Model Evaluation and Conclusions</h2>
<p>Evaluate the clustering result using silhouette score:</p>
<div id="ab4a0df0" class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate silhouette score</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>sil_score <span class="op">=</span> silhouette_score(scaled_data, clusters)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Silhouette Score: </span><span class="sc">{</span>sil_score<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Silhouette Score: 0.21503808606365246</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sihoutte score
</div>
</div>
<div class="callout-body-container callout-body">
<p>A silhouette score of 0.215 <strong><em>suggests that the clusters might be overlapping or not distinctly separated and indicates room for improvement</em></strong>.</p>
</div>
</div>
<section id="conclusion-the-four-significant-groups" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-the-four-significant-groups">Conclusion: The Four Significant Groups</h3>
<p>To analyze the cluster centers into four significant groups, we will examine various attributes and categorize the rows based on similarities and differences. Here is a detailed breakdown:</p>
<ol type="1">
<li><strong>High Spending and High Balance</strong>
<ul>
<li>This group has high balances and high spending on purchases, including both one-off and installment purchases. They also have high credit limits and good payment histories.</li>
<li>Examples:
<ul>
<li><strong>Row 0</strong>: Balance of $4541.39, high purchases ($15777.31), and a substantial credit limit ($12493.02).</li>
<li><strong>Row 2</strong>: Balance of $1828.40, significant purchases ($3009.46), and a high credit limit ($7047.42).</li>
</ul></li>
<li>These customers are actively using their credit and have significant balances. They are <strong><em>likely to be valuable clients due to their high engagement and spending</em></strong>.</li>
</ul></li>
<li><strong>High Balance but Low Spending</strong>
<ul>
<li>This group has high balances and credit limits but low purchase amounts and frequencies, indicating lower transaction activity.</li>
<li>Examples:
<ul>
<li><strong>Row 1</strong>: Balance of $5033.10, but low purchases ($564.52) and high cash advance ($5153.57).</li>
<li><strong>Row 5</strong>: Balance of $1580.74, with lower purchases ($268.43) and a relatively high cash advance ($760.33).</li>
</ul></li>
<li>These customers have high credit limits but are not utilizing them much. They may be <strong><em>less engaged or could be saving their credit for future use</em></strong>.</li>
</ul></li>
<li><strong>Low Balance and High Cash Advance</strong>
<ul>
<li>This group has lower balances but high cash advances with modest purchase amounts. They show a higher frequency of cash advances relative to purchases.</li>
<li>Examples:
<ul>
<li><strong>Row 3</strong>: Balance of $799.44, with high cash advance ($206.95) and low purchase activity ($918.09).</li>
<li><strong>Row 6</strong>: Balance of $103.59, with high cash advance ($301.36) and low purchases ($347.46).</li>
</ul></li>
<li>These customers frequently use cash advances despite having lower balances. They might be <strong><em>facing financial difficulties or prefer cash over credit</em></strong>.</li>
</ul></li>
<li><strong>Low Balance and Low Spending</strong>
<ul>
<li>This group has low balances and spending across all purchase categories, indicating minimal activity and expenditure.</li>
<li>Examples:
<ul>
<li><strong>Row 6</strong>: Balance of $103.59, with minimal purchases ($347.46) and low credit limit ($3865.96).</li>
<li><strong>Row 4</strong>: Balance of $866.15, with low purchases ($395.31) and a lower credit limit ($2468.23).
<ul>
<li>Additionally, the accounts in Row 4 have a tenure of 7.2, the lowest among all others. This suggests these customers have used their credit accounts for a shorter period compared to the rest.</li>
</ul></li>
</ul></li>
<li>This group shows minimal engagement with their credit accounts. They have low balances and low spending, suggesting limited usage or disinterest. This group might <strong><em>include new accounts that have not fully explored the features and benefits of their credit accounts</em></strong>.</li>
</ul></li>
</ol>
<p>This classification can help the company target different customer segments and personalize their financial products or interventions.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>